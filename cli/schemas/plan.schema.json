{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/fractary/faber/main/plugins/faber/config/schemas/plan.schema.json",
  "title": "FABER Plan Schema",
  "description": "JSON Schema for FABER workflow plans generated by CLI or Claude plugin",
  "type": "object",
  "required": ["plan_id", "created_by", "created_at", "workflow", "phases"],
  "additionalProperties": true,
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri",
      "description": "JSON Schema reference for IDE validation"
    },
    "plan_id": {
      "type": "string",
      "pattern": "^fractary-faber-[0-9]+-[0-9]{8}-[0-9]{6}$",
      "description": "Unique plan identifier (format: fractary-faber-{work-id}-{YYYYMMDD}-{HHMMSS})",
      "examples": ["fractary-faber-258-20260106-143022"]
    },
    "created_by": {
      "type": "string",
      "enum": ["cli", "claude", "api"],
      "description": "Tool that created the plan"
    },
    "cli_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Version of CLI that created the plan (if created_by: cli)",
      "examples": ["3.4.0"]
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when plan was created"
    },
    "issue": {
      "type": "object",
      "required": ["source", "id"],
      "description": "Issue metadata - links plan to originating work item",
      "properties": {
        "source": {
          "type": "string",
          "enum": ["github", "jira", "linear", "manual"],
          "description": "Issue tracking system"
        },
        "id": {
          "type": "string",
          "description": "Issue identifier (e.g., issue number)"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Full URL to issue"
        }
      }
    },
    "branch": {
      "type": "string",
      "description": "Git branch name for this workflow (e.g., feature/258)"
    },
    "worktree": {
      "type": "string",
      "description": "Git worktree path (e.g., ~/.claude-worktrees/fractary-myproject-258)"
    },
    "workflow": {
      "type": "string",
      "description": "Workflow type identifier (e.g., etl, bugfix, core)"
    },
    "overall_complexity": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "description": "Overall estimated complexity"
    },
    "estimated_phases": {
      "type": "integer",
      "minimum": 1,
      "description": "Estimated number of phases to complete"
    },
    "special_considerations": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Special notes or warnings for this workflow"
    },
    "phases": {
      "type": "array",
      "description": "Ordered list of workflow phases",
      "items": {
        "$ref": "#/definitions/phase"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata (flexible)",
      "properties": {
        "org": {
          "type": "string",
          "description": "GitHub organization"
        },
        "project": {
          "type": "string",
          "description": "Project/repository name"
        },
        "subproject": {
          "type": "string",
          "description": "Subproject identifier (optional)"
        }
      }
    },
    "autonomy": {
      "type": "string",
      "enum": ["supervised", "assisted", "autonomous", "guarded"],
      "description": "Autonomy level for workflow execution"
    }
  },
  "definitions": {
    "phase": {
      "type": "object",
      "required": ["phase", "description", "steps"],
      "properties": {
        "phase": {
          "type": "string",
          "description": "Phase identifier (e.g., frame, architect, build, evaluate, release)"
        },
        "description": {
          "type": "string",
          "description": "What this phase accomplishes"
        },
        "steps": {
          "type": "array",
          "description": "Specific steps for this phase",
          "items": {
            "$ref": "#/definitions/step"
          }
        },
        "success_criteria": {
          "type": "array",
          "description": "Criteria to verify phase completion",
          "items": {
            "type": "string"
          }
        },
        "complexity": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Phase complexity estimate"
        }
      }
    },
    "step": {
      "type": "object",
      "required": ["action"],
      "properties": {
        "action": {
          "type": "string",
          "description": "Specific action to take"
        },
        "details": {
          "type": "string",
          "description": "Additional context or requirements"
        },
        "command": {
          "type": ["string", "null"],
          "description": "Shell command to execute (optional)"
        },
        "prompt": {
          "type": "string",
          "description": "LLM prompt for this step (optional)"
        },
        "artifacts": {
          "type": "object",
          "description": "Expected artifacts from this step"
        }
      }
    }
  },
  "examples": [
    {
      "plan_id": "fractary-faber-258-20260106-143022",
      "created_by": "cli",
      "cli_version": "3.4.0",
      "created_at": "2026-01-06T14:30:22Z",
      "issue": {
        "source": "github",
        "id": "258",
        "url": "https://github.com/fractary/myproject/issues/258"
      },
      "branch": "feature/258",
      "worktree": "~/.claude-worktrees/fractary-myproject-258",
      "workflow": "etl",
      "overall_complexity": "medium",
      "estimated_phases": 5,
      "phases": [
        {
          "phase": "frame",
          "description": "Understand requirements and plan approach",
          "steps": [
            {
              "action": "Read issue description and extract requirements",
              "details": "Identify data source, target format, and validation rules"
            }
          ],
          "success_criteria": [
            "Requirements documented",
            "Data source identified"
          ],
          "complexity": "low"
        },
        {
          "phase": "architect",
          "description": "Design ETL pipeline architecture",
          "steps": [
            {
              "action": "Design data transformation logic",
              "details": "Map source fields to target schema"
            }
          ],
          "success_criteria": [
            "Architecture documented",
            "Data flow mapped"
          ],
          "complexity": "medium"
        }
      ],
      "autonomy": "supervised"
    }
  ]
}
