{
  "$schema": "../workflow.schema.json",
  "id": "default",
  "description": "Default FABER workflow for software development - extends core with spec generation and implementation",
  "extends": "fractary-faber:core",
  "phases": {
    "frame": {
      "enabled": true,
      "pre_steps": [
        {
          "id": "auto-reload-context",
          "name": "Reload Context",
          "description": "Automatically reload critical artifacts for session continuity",
          "prompt": "/fractary-faber:prime-context"
        },
        {
          "id": "core-issue-refine",
          "name": "Refine Issue",
          "description": "Clarify issue details with user",
          "prompt": "/fractary-work:issue-clarify --work-id {work_id}"
        }
      ],
      "steps": [],
      "post_steps": []
    },
    "architect": {
      "enabled": true,
      "description": "Generate and refine technical specification from issue context",
      "pre_steps": [],
      "steps": [
        {
          "id": "generate-spec",
          "name": "Generate Specification",
          "description": "Create technical specification from issue context",
          "prompt": "/fractary-spec:create --work-id {work_id}"
        },
        {
          "id": "refine-spec",
          "name": "Refine Specification",
          "description": "Critically review spec and gather clarifications from user",
          "prompt": "/fractary-spec:refine --work-id {work_id}"
        }
      ],
      "post_steps": []
    },
    "build": {
      "enabled": true,
      "description": "Implement solution based on specification",
      "pre_steps": [],
      "steps": [
        {
          "id": "implement",
          "name": "Implement Solution",
          "description": "Implement based on specification following project patterns",
          "prompt": "Implement the solution according to the specification. Follow existing project patterns and conventions. Create atomic commits for each logical unit of work. Run tests to verify the implementation. Ensure code quality and completeness."
        }
      ],
      "post_steps": []
    },
    "evaluate": {
      "enabled": true,
      "pre_steps": [],
      "steps": [],
      "post_steps": []
    },
    "release": {
      "enabled": true,
      "pre_steps": [],
      "steps": [],
      "post_steps": []
    }
  },
  "autonomy": {
    "level": "guarded",
    "description": "Pauses before release for approval - recommended for production",
    "require_approval_for": ["release"]
  },
  "critical_artifacts": {
    "always_load": [
      {
        "id": "workflow-state",
        "type": "json",
        "path": ".fractary/runs/{run_id}/state.json",
        "description": "Current workflow state file - essential for continuation",
        "required": true,
        "reload_triggers": ["session_start", "manual"]
      },
      {
        "id": "orchestration-protocol",
        "type": "markdown",
        "path": "plugins/faber/docs/workflow-orchestration-protocol.md",
        "description": "Workflow execution protocol - defines how to execute steps",
        "required": true,
        "reload_triggers": ["session_start"]
      }
    ],
    "conditional_load": [
      {
        "id": "specification",
        "type": "markdown",
        "path_from_state": "artifacts.spec_path",
        "description": "Technical specification for the work",
        "required": false,
        "condition": "state.artifacts.spec_path != null",
        "reload_triggers": ["session_start", "phase_transition:architect->build"]
      }
    ]
  }
}
