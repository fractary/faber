{
  "$schema": "../workflow.schema.json",
  "id": "core",
  "description": "Core FABER workflow primitives - issue management, branching, PR lifecycle. Meant to be extended by other workflows.",
  "phases": {
    "frame": {
      "enabled": true,
      "description": "Fetch work item and setup branch",
      "pre_steps": [
        {
          "id": "auto-reload-context",
          "name": "Reload Context",
          "description": "Automatically reload critical artifacts for session continuity",
          "prompt": "/fractary-faber:prime-context"
        },
        {
          "id": "core-fetch-issue",
          "name": "Fetch Issue",
          "description": "Fetch existing issue. Reads referenced docs and existing commits.",
          "prompt": "/fractary-work:issue-fetch --work-id {work_id}"
        }
      ],
      "steps": [],
      "post_steps": [
        {
          "id": "core-commit-and-push-frame",
          "name": "Commit and Push Changes",
          "description": "Ensure all frame changes are committed and pushed",
          "prompt": "/fractary-repo:commit-push"
        }
      ]
    },
    "architect": {
      "enabled": true,
      "description": "Design and plan - extend this phase in child workflows",
      "pre_steps": [
        {
          "id": "auto-reload-context",
          "name": "Reload Context",
          "description": "Automatically reload critical artifacts for session continuity",
          "prompt": "/fractary-faber:prime-context"
        }
      ],
      "steps": [],
      "post_steps": [
        {
          "id": "core-commit-and-push-architect",
          "name": "Commit and Push Changes",
          "description": "Ensure all build changes are committed and pushed",
          "prompt": "/fractary-repo:commit-push"
        }
      ]
    },
    "build": {
      "enabled": true,
      "description": "Implementation - extend this phase in child workflows",
      "pre_steps": [
        {
          "id": "auto-reload-context",
          "name": "Reload Context",
          "description": "Automatically reload critical artifacts for session continuity",
          "prompt": "/fractary-faber:prime-context"
        }
      ],
      "steps": [],
      "post_steps": [
        {
          "id": "core-commit-and-push-build",
          "name": "Commit and Push Changes",
          "description": "Ensure all build changes are committed and pushed",
          "prompt": "/fractary-repo:commit-push"
        }
      ]
    },
    "evaluate": {
      "enabled": true,
      "description": "Review implementation and create PR",
      "pre_steps": [
        {
          "id": "auto-reload-context",
          "name": "Reload Context",
          "description": "Automatically reload critical artifacts for session continuity",
          "prompt": "/fractary-faber:prime-context"
        }
      ],
      "steps": [],
      "post_steps": [
        {
          "id": "core-create-pr",
          "name": "Create Pull Request",
          "description": "Create PR for the implementation (skips if PR already exists). Links to issue for auto-close on merge.",
          "prompt": "/fractary-repo:commit-push-pr"
        },
        {
          "id": "core-review-pr-checks",
          "name": "Review PR CI Checks",
          "description": "Wait for and review CI/CD pipeline results",
          "prompt": "/fractary-repo:pr-review --wait-for-ci"
        }
      ]
    },
    "release": {
      "enabled": true,
      "description": "Merge PR and complete workflow",
      "require_approval": true,
      "pre_steps": [
        {
          "id": "auto-reload-context",
          "name": "Reload Context",
          "description": "Automatically reload critical artifacts for session continuity",
          "prompt": "/fractary-faber:prime-context"
        }
      ],
      "steps": [],
      "post_steps": [
        {
          "id": "core-merge-pr",
          "name": "Merge Pull Request",
          "description": "Merge the PR and delete branch",
          "prompt": "/fractary-repo:pr-merge {pr_number} --delete-branch"
        }
      ]
    }
  },
  "autonomy": {
    "level": "guarded",
    "description": "Pauses before release for approval - recommended for production",
    "require_approval_for": ["release"]
  },
  "critical_artifacts": {
    "always_load": [
      {
        "id": "workflow-state",
        "type": "json",
        "path": ".fractary/runs/{run_id}/state.json",
        "description": "Current workflow state file - essential for continuation",
        "required": true,
        "reload_triggers": ["session_start", "manual"]
      },
      {
        "id": "orchestration-protocol",
        "type": "markdown",
        "path": "plugins/faber/docs/workflow-orchestration-protocol.md",
        "description": "Workflow execution protocol - defines how to execute steps",
        "required": true,
        "reload_triggers": ["session_start"]
      }
    ],
    "conditional_load": [
      {
        "id": "issue-context",
        "type": "work_plugin",
        "command": "/fractary-work:issue-fetch {work_id}",
        "description": "Issue details and context",
        "required": false,
        "condition": "state.work_id != null",
        "reload_triggers": ["session_start"]
      }
    ]
  }
}
